<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <form id="uploadForm">
      <!-- <input type="text" name="ID" placeholder="ID" />
      <br /> -->
      <input type="file" name="image" required />
      <br />
      <input type="text" name="resName" placeholder="Í∞ÄÍ≤åÎ™Ö" />
      <br />
      <input type="text" name="foodName" placeholder="ÏùåÏãùÎ™Ö" required />
      <br />
      <input type="text" name="comment" placeholder="ÏùåÏãùÌèâ" required />
      <br />
      <input type="number" name="price" placeholder="Í∞ÄÍ≤©" required />
      <br />
      <input type="text" name="address" placeholder="Í∞ÄÍ≤å Ï£ºÏÜå" required />
      <br />
      <input type="date" name="date" required />
      <br />

      <button onclick="createData(event)">Îì±Î°ù</button>
      <br />
      <br />
    </form>
    <table border="2">
      <thead>
        <tr>
          <th>Ïù¥ÎØ∏ÏßÄ</th>
          <th>ÏãùÎãπ Ïù¥Î¶Ñ</th>
          <th>Î©îÎâ¥Î™Ö</th>
          <th>ÌõÑÍ∏∞</th>
          <th>Í∞ÄÍ≤©</th>
          <th>Ï£ºÏÜå</th>
          <th>ÎÇ†Ïßú</th>
          <th>ÏàòÏ†ï</th>
          <th>ÏÇ≠Ï†ú</th>
        </tr>
      </thead>
      <tbody>
        <% for (let i = 0; i < food.length; i++) { %>
        <tr>
          <td>
            <img src="<%= food[i].image %>" width="50" alt="ÏùåÏãù Ïù¥ÎØ∏ÏßÄ" />
          </td>
          <td><%= food[i].resName %></td>
          <td><%= food[i].foodName %></td>
          <td><%= food[i].comment %></td>
          <td><%= food[i].price %>Ïõê</td>
          <td><%= food[i].address %></td>
          <td><%= food[i].createdAt %></td>
          <td>
            <button onclick="updatePage('<%= food[i].id %>')" type="button">
              ÏàòÏ†ï
            </button>
          </td>
          <td>
            <button onclick="deletelist('<%= food[i].id %>')" type="button">
              ÏÇ≠Ï†ú
            </button>
          </td>
        </tr>
        <% } %>
      </tbody>
    </table>
  </body>
  <script>
    const createData = (event) => {
      event.preventDefault();

      // HTML ÏöîÏÜåÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
      const inputFile = document.querySelector('input[name="image"]').files[0];
      // const inputId = document.querySelector('input[name="ID"]').value;
      const inputResName = document.querySelector(
        'input[name="resName"]'
      ).value;
      const inputFoodName = document.querySelector(
        'input[name="foodName"]'
      ).value;
      const inputComment = document.querySelector(
        'input[name="comment"]'
      ).value;
      const inputPrice = document.querySelector('input[name="price"]').value;
      const inputDate = document.querySelector('input[name="date"]').value;
      const inputAddress = document.querySelector(
        'input[name="address"]'
      ).value;

      // **üìå FormData Í∞ùÏ≤¥ ÏÉùÏÑ± (ÌååÏùº ÏóÖÎ°úÎìú)**
      const formData = new FormData();
      formData.append("image", inputFile);
      formData.append("resName", inputResName);
      formData.append("foodName", inputFoodName);
      formData.append("comment", inputComment);
      formData.append("price", inputPrice);
      formData.append("address", inputAddress);
      formData.append("date", inputDate);

      console.log("üì§ Ï†ÑÏÜ°Ìï† Îç∞Ïù¥ÌÑ∞:", formData);

      // **üìå AxiosÎ•º ÏÇ¨Ïö©ÌïòÏó¨ ÏÑúÎ≤ÑÎ°ú Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ° (`multipart/form-data`)**
      axios
        .post("/save/post/test", formData, {
          headers: { "Content-Type": "multipart/form-data" },
        })
        .then((res) => {
          console.log("‚úÖ Îì±Î°ù ÏÑ±Í≥µ:", res.data);
          alert("Îì±Î°ù ÏÑ±Í≥µ");
          window.location.reload();
        })
        .catch((e) => {
          console.error("‚ùå Îì±Î°ù Ïã§Ìå®:", e);
        });
    };

    // ÏÇ≠Ï†ú
    const deletelist = (id) => {
      console.log(id);
      axios({
        method: "delete",
        url: `/save/delete/${id}`,
      })
        .then((res) => {
          console.log(res);
          alert("ÏÇ≠Ï†ú ÏÑ±Í≥µ");
          window.location.reload();
        })
        .catch((e) => {
          console.log(e);
        });
    };

    // ÏàòÏ†ï
    const updatePage = (id) => {
      window.location.href = `/save/write/${id}`;
    };
  </script>
</html>
